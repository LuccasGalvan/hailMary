@using RCLAPI.DTO
@inject RCLAPI.Services.IApiServices _apiServices

<div class="carousel-container">
    <button class="carousel-nav left" @onclick="PreviousSlide" disabled="@(!CanGoPrev)">❮</button>

    <div class="carousel-track">
        @if (tipos == null)
        {
            <p>A carregar...</p>
        }
        else
        {
            @foreach (var t in VisibleTipos)
            {
                <button class="tipo-card @(t.TipoCategoriaId == SelectedTipoId ? "selected" : "")"
                        @onclick="() => SelectTipo(t.TipoCategoriaId)">
                    @t.Nome
                </button>
            }
        }
    </div>

    <button class="carousel-nav right" @onclick="NextSlide" disabled="@(!CanGoNext)">❯</button>
</div>

@code {
    private List<TipoCategoriaDTO>? tipos;
    private int startIndex = 0;
    private int itemsPerView = 6;

    [Parameter] public int SelectedTipoId { get; set; }
    [Parameter] public EventCallback<int> SelectedTipoIdChanged { get; set; }

    protected override async Task OnInitializedAsync()
    {
        tipos = await _apiServices.GetTiposCategoria();
    }

    private IEnumerable<TipoCategoriaDTO> VisibleTipos =>
        (tipos ?? new()).Skip(startIndex).Take(itemsPerView);

    private bool CanGoPrev => startIndex > 0;
    private bool CanGoNext => tipos != null && (startIndex + itemsPerView) < tipos.Count;

    private void PreviousSlide()
    {
        if (CanGoPrev) startIndex = Math.Max(0, startIndex - itemsPerView);
    }

    private void NextSlide()
    {
        if (CanGoNext) startIndex = Math.Min(tipos!.Count - itemsPerView, startIndex + itemsPerView);
    }

    private async Task SelectTipo(int id)
    {
        await SelectedTipoIdChanged.InvokeAsync(id);
        // opcional: reset do scroll das categorias quando muda tipo
    }
}
